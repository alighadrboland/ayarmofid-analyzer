<script>
  async function fetchData() {
    try {
      const res = await fetch("https://ayarmofid-api-wmf1.vercel.app/ayarmofid.js");
      const latest = await res.json();

      // ØªØ­Ù„ÛŒÙ„ Ø³ÛŒÚ¯Ù†Ø§Ù„
      let signal = "";
      if (latest.pbr > 2 && latest.netBuy > 500000000 && latest.rsi < 30) {
        signal = "ğŸ“ˆ Ø³ÛŒÚ¯Ù†Ø§Ù„ ÙˆØ±ÙˆØ¯";
      } else if (latest.pbr < 1 && latest.netBuy < -500000000 && latest.rsi > 70) {
        signal = "ğŸ“‰ Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø®Ø±ÙˆØ¬";
      } else {
        signal = "âš–ï¸ Ø¨Ø¯ÙˆÙ† Ø³ÛŒÚ¯Ù†Ø§Ù„ Ù‚Ø·Ø¹ÛŒ";
      }

      document.getElementById("signal").textContent = signal;

      // Ø±Ø³Ù… Ù†Ù…ÙˆØ¯Ø§Ø± ÙØ±Ø¶ÛŒ
      const ctx = document.getElementById("chart").getContext("2d");
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['Ù‚ÛŒÙ…Øª', 'RSI', 'Ù‚Ø¯Ø±Øª Ø®Ø±ÛŒØ¯ Ø­Ù‚ÛŒÙ‚ÛŒ', 'Ø®Ø§Ù„Øµ Ø®Ø±ÛŒØ¯ Ø­Ù‚ÛŒÙ‚ÛŒ'],
          datasets: [{
            label: 'ØªØ­Ù„ÛŒÙ„ Ø±ÙˆØ²',
            data: [latest.price, latest.rsi, latest.pbr, latest.netBuy],
            backgroundColor: ['blue', 'orange', 'green', 'red']
          }]
        }
      });

    } catch (e) {
      document.getElementById("signal").textContent = "Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡";
      console.error(e);
    }
  }

  fetchData();
</script>
